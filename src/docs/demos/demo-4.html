<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friction DOM</title>
    <style>
      html, body {background-color: black; margin: 0; padding: 0;}
      * {box-sizing: border-box;}
      .dialog {
        background-color: white;
        width: 100%;
        height: 200vh;
        padding: 20px;
        text-align: center;
        z-index: 2;
      }

      main {
        background-color: white;
        min-height: 100vh;
        padding: 20px;
        transform-origin: center 10px;
      }

      span {
        display: block;
        height: 50px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        box-shadow: 0 -20px 0 10px black;
        background: transparent;
        z-index: 1;
        transform-origin: center top;
        pointer-events: none;
      }
      
      main p {
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }
    </style>
  </head>
  <body>
    <span></span>

    <main>
      <p>
        I watch way too many ads online and I don't do enough situps. So I bought these. Now, every time an ad pops up online, I get 30 seconds of ab blasting. I call it Ads for Abs. Ironically, I learned about the boots from an ad online. I have been very honest with you guys. In a way that could seriously impact the political career of a very good friend of mine. You're not going to use any of that, are you? [watching at his bar] People actually dance to this. It’s in my juke box. None of the money goes to Andy though. Michael's movie? Two thumbs down. [Smiles] Heh. Pam texted back saying we could give them all iPods.
      </p>
      <p>
        [on the phone] Hey, uh, yeah, I finally got a chance to sit down with HR. So... well, I think I'm gonna be here for awhile. Dogs don't do that. Did you get anything good? I think that's important. That is important. Bummer, but important. I guess they got what they want. I am eating alone. Might as well be dinner.
      </p>
      <p>
        Is that supposed to be me? Uh, she might mention an email that I wrote a while back, um - Oh, from the insurance commercials! They have one of those? Come on, get inside.
      </p>
      <p>
        I told Dwight that there is honor in losing. Which, as we all know, is completely ridiculous, but there is, however, honor in making a loser feel better which is what I just did for Dwight. Would I rather be feared or loved? Um, easy. Both. I want people to be afraid of how much they love me. And I think I proved that today at the dojo. [agreeing] Mm. You know what, guys, let's just enjoy lunch. I don't know, it's just... Hey, look! I'm king of the world!
      </p>
      <p>
        Charles is having Kevin cover the phones for a while. How do I say this diplomatically? [pause] I think Kevin is doing exactly as well as anyone might have expected someone like him to perform in a position like that. I got his pants. What if Dwight dies and I still owe him something? That is a recipe for a ghost. [groans painfully] Well, if you're wondering why his wife was staring daggers at me, it's because I kinda saw him for a little bit while they were separated.
      </p>
      <p>
        Hello. Yeah probably. Hey, Michael? Kelly and I both agreed that we would just have fun, and, I'm learning that fun for Kelly is... getting married and having babies. Immediately. With me. Hey Michael. Hey Michael, how was your date last night?
      </p>
      <p>
        Wow. This whole Philly thing has been so much fun that I may have lost sight of what really matters. I mean, having fun is not nearly as important as being good to the people who you really care about. I mean, that's just 'Roommates 101'. It's getting chilly. No question about it, I am ready to get hurt again. When you use a ridiculous font, no one thinks you have a plan. OK. You tell 'em. With my permission. Permission granted.
      </p>
      <p>
        I begged Dwight and Jim to give me Erin for Secret Santa. And I decided to give Erin the Twelve days of Christmas. Is it my fault that the first eight days is basically thirty birds? [six geese are inside Erin's car] They always say that it is a mistake to hire your friends and they are right! So, I hired my best friends. And this is what I get? Problem solved everyone. Space Orphan and Princess Nincompoop are off to rescue Michael. Unbelievable. I'm going. You drive, I got a car full of fox meat. I deserved that promotion, not Jim. Oh, man. Makes me want to put him in a triangle choke hold and force him down to the ground and just keep pressing and pressing. And then flip him over and then put him in a hammer lock! And he's gasping, he's panting! Every last breath! And the crowd is going crazy. And boom! I emerge victorious! [claps hands and stands up] Aha! $18,000 and a chance at the title! Ooh hah! Ahh! [bird steals her hat]
      </p>
      <p>
        Now that I own the building, I'm looking for new sources of revenue. And a daycare center... Ha ha ha [laughing maniacally] Well I guess it's not an evil idea. It's just a regular idea. But there is no good laugh for a regular idea. Look, that, that's not what I wanted, ok. I just wanted to go on a sales call. Poop is raining from the ceilings. Poop! No. There's no one else. Mmm, I can't hold it in any longer. Um, I am faking this, okay? Because I convinced David Wallace to buy Dunder Mifflin back from Sabre. And at three o'clock today he's gonna walk in here and reinstate me as manager.
      </p>
      <p>
        I'm peeing in this empty can. [exits Andy's office smiling] All I need is Kevin. Dude buys more cookies than everyone combined and then some. [Kevin waves at him] When I first started selling cookies he was a relatively thin man. Not a thin man, mind you. Relatively thin. And Filipino. But we’ll break that to her later. Hey Michael. You have to use chains?
      </p>
    </main>

    <div class="dialog">
      <p style="margin-top: 0;">
        This is the dialog, slide me up
      </p>
      <label>
        This is an input
        <input />
      </label>
    </div>

    <script src="../../../dist/friction-dom.js"></script>
    <script>
      const dom = document.querySelector('div');
      const main = document.querySelector('main');
      const span = document.querySelector('span');

      const surface = new FrictionDOM.Surface(window, {
        paddingMaxY: 60,
        paddingMinY: () => window.innerHeight * 0.04,
      });

      const object = new FrictionDOM.SurfaceObject(dom, surface, {
        nudgeThreshold: 50,
        axis: 'y',
        contained: false,
        additionalHandles: [
          dom.querySelector('p'),
        ]
      });

      object.onPositionChange(data => {
        const {yp} = data;
        const amount = (1 - yp) * .07;
        const rad = (1 - yp) * 10;
        const op = (1 - yp) * 0.1;
        const bs = (1 - yp) * 0.2;

        main.style.transform = `scale(${1 - amount}) translateY(${rad}px)`;
        main.style.transformOrigin = `center ${window.scrollY + 10}px`;
        main.style.opacity = 1 - op;
        dom.style.boxShadow = `0 0 10px rgba(0, 0, 0, ${bs})`;
        dom.style.borderRadius = `${rad}px`;

        span.style.transform = `scale(${1 - amount})`;
        span.style.borderRadius = `${rad}px`;
        span.style.top = `${rad}px`;

        if (yp === 1) {
          document.body.style.overflow = 'auto';
        } else {
          document.body.style.overflow = 'hidden';
        }
      });

      // the problem is that the DOM is a large scrollable view, whereas the browser is always trying to move
      // up and down. On an app only a portion of the screen is scrollable, on the website the entire
      // document is scrollable, and that complicates things.

      // you may think you can just scrollock the entire page and make just a region scrollable (like on an app)
      // but this breaks much of the expected UX of browsing the web like global scroll bar, scroll restoration,
      // anchor links, etc (way around this?)

      // doing this on the capturing phase of the event and then preventing default actually seems to work...
      // in combination of scroll locking when no 0 position

      // another thing to consider is that this is almost never a problem is folks download your site for "offline"
      // usage, but only a small percentage of sites make this available (probabably rightfully so) and only a small
      // number of users of those sites take them up on it (actually download)

      // need to figure out better screen resize behavior, particularly annoying on mobile safari that resizes vertically
      // whenever your scroll (shows/hides address bar)

      // should also allow initializing in either the min or max
    </script>
  </body>
</html>
